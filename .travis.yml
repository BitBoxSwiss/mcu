language: c
os:
    - osx
    - linux
    
compiler:
    - clang
    - gcc

matrix:
    exclude:
        - os: osx
          compiler: gcc
    fast_finish:
        - true

install:
  - sudo apt-get update -qq
  - sudo apt-get install -y -qq lcov curl

before_install: 
    - wget http://sourceforge.net/projects/astyle/files/astyle/astyle%202.05.1/astyle_2.05.1_linux.tar.gz
    - tar xfv astyle_2.05.1_linux.tar.gz
    - cd astyle/build/gcc && make
    - export PATH=$PATH:$PWD/bin/

before_script:
    - cd $TRAVIS_BUILD_DIR
    - if astyle --style=stroustrup --indent-switches --indent-labels --pad-oper --pad-header --align-pointer=name --add-brackets --convert-tabs --max-code-length=90 --break-after-logical --suffix=none *.c *.h --recursive --exclude=astyle --dry-run -Q | grep "Formatted" ; then exit 1 ; fi

script: 
    - mkdir build && cd build
    - cmake .. -DCONTINUOUS_INTEGRATION=1 && make
    - make test
    - make clean

after_success:
    - cmake .. -DCONTINUOUS_INTEGRATION=1 -DCOVERALLS=1 && make
    - make coveralls

